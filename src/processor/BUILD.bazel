load("@rules_cc//cc:defs.bzl", "cc_library")

cc_library(
    name = "operators",
    srcs = [
        "physical_plan/expression_mapper.cpp",
        "physical_plan/operator/column_reader/adj_column_extend.cpp",
        "physical_plan/operator/column_reader/column_reader.cpp",
        "physical_plan/operator/column_reader/node_property_column_reader.cpp",
        "physical_plan/operator/column_reader/rel_property_column_reader.cpp",
        "physical_plan/operator/hash_join/hash_join_build.cpp",
        "physical_plan/operator/hash_join/hash_join_probe.cpp",
        "physical_plan/operator/filter/filter.cpp",
        "physical_plan/operator/flatten/flatten.cpp",
        "physical_plan/operator/list_reader/adj_list_extend.cpp",
        "physical_plan/operator/list_reader/extend/adj_list_only_extend.cpp",
        "physical_plan/operator/list_reader/list_reader.cpp",
        "physical_plan/operator/list_reader/rel_property_list_reader.cpp",
        "physical_plan/operator/sink/result_collector.cpp",
    ],
    hdrs = [
        "include/physical_plan/expression_mapper.h",
        "include/physical_plan/query_result.h",
        "include/physical_plan/operator/column_reader/adj_column_extend.h",
        "include/physical_plan/operator/column_reader/column_reader.h",
        "include/physical_plan/operator/column_reader/node_property_column_reader.h",
        "include/physical_plan/operator/column_reader/rel_property_column_reader.h",
        "include/physical_plan/operator/hash_join/hash_join_build.h",
        "include/physical_plan/operator/hash_join/hash_join_probe.h",
        "include/physical_plan/operator/filter/filter.h",
        "include/physical_plan/operator/flatten/flatten.h",
        "include/physical_plan/operator/list_reader/adj_list_extend.h",
        "include/physical_plan/operator/list_reader/extend/adj_list_flatten_and_extend.h",
        "include/physical_plan/operator/list_reader/extend/adj_list_only_extend.h",
        "include/physical_plan/operator/list_reader/list_reader.h",
        "include/physical_plan/operator/list_reader/rel_property_list_reader.h",
        "include/physical_plan/operator/physical_operator.h",
        "include/physical_plan/operator/scan/physical_scan.h",
        "include/physical_plan/operator/sink/sink.h",
        "include/physical_plan/operator/sink/result_collector.h",
        "include/physical_plan/operator/tuple/tuple.h",
        "include/physical_plan/operator/tuple/physical_operator_info.h",
        "include/task_system/morsel.h",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "data_chunks",
        "memory_manager",
        "//src/expression",
        "//src/storage:graph",
        "//src/storage:structures",
        "//src/common",
    ],
)

cc_library(
    name = "data_chunks",
    srcs = [
        "physical_plan/operator/tuple/data_chunks.cpp",
        "physical_plan/operator/tuple/data_chunks_iterator.cpp",
    ],
    hdrs = [
        "include/physical_plan/operator/tuple/data_chunks.h",
        "include/physical_plan/operator/tuple/tuple.h",
        "include/physical_plan/operator/tuple/data_chunks_iterator.h",
    ],
    deps = [
        "//src/common",
        "//src/storage:structures",
    ],
)

cc_library(
    name = "physical_plan",
    srcs = [
        "physical_plan/plan_mapper.cpp",
    ],
    hdrs = [
        "include/physical_plan/physical_plan.h",
        "include/physical_plan/plan_mapper.h",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "operators",
        "//src/planner:logical_plan",
        "//src/storage:graph",
    ],
)

cc_library(
    name = "processor",
    srcs = [
        "processor.cpp",
        "task_system/task.cpp",
        "task_system/task_queue.cpp",
    ],
    hdrs = [
        "include/processor.h",
        "include/task_system/task.h",
        "include/task_system/task_queue.h",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "physical_plan",
        "//src/common:timer",
        "//src/storage:graph",
    ],
)

cc_library(
    name = "memory_manager",
    srcs = [
        "memory_manager.cpp"
    ],
    hdrs = [
        "include/memory_manager.h"
    ],
    visibility = ["//visibility:public"],
    deps = [
        "//src/common"
    ],
)
