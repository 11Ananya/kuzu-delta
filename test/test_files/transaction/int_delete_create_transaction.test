-GROUP CreateDeleteInt64NodeTrxTest
-DATASET CSV node-insertion-deletion-tests/int64-pk

--

#MixedInsertDeleteCommitNormalExecution
-CASE MixedInsertDeleteCommitNormalExecution
-LOG Mixed Insert Delete Commit Normal Execution
#-CHECKPOINT_WAIT_TIMEOUT 100000
-CREATE_CONNECTION conn1
-CREATE_CONNECTION conn2
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn2] MATCH (a:person) WHERE a.ID=8000 DELETE a;
---- ok
-STATEMENT [conn2] MATCH (a:person) WHERE a.ID=9000 DELETE a;
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:8000});
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:9000});
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:10001});
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:10002});
---- ok
-STATEMENT [conn2] Match (:person) RETURN COUNT(*);
---- 1
10002
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn2] COMMIT
---- ok 
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
10002
-STATEMENT [conn2] MATCH (a:person) DELETE a;
---- ok
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
10002
-STATEMENT [conn2] Match (:person) RETURN COUNT(*);
---- 1
0
-STATEMENT [conn2] COMMIT
---- ok 
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
0
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:10000099});
---- ok
-STATEMENT [conn1] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
0
-STATEMENT [conn2] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn2] COMMIT
---- ok 
-STATEMENT [conn1] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
1

#MixedInsertDeleteCommitRecovery
-CASE MixedInsertDeleteCommitRecovery
-LOG Mixed Insert Delete Commit Recovery
-CREATE_CONNECTION conn1
-CREATE_CONNECTION conn2
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn2] MATCH (a:person) WHERE a.ID=8000 DELETE a;
---- ok
-STATEMENT [conn2] MATCH (a:person) WHERE a.ID=9000 DELETE a;
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:8000});
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:9000});
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:10001});
---- ok
-STATEMENT [conn2] CREATE (a:person {ID:10002});
---- ok
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn2] Match (:person) RETURN COUNT(*);
---- 1
10002

#RECOVERY
#init db?
-STATEMENT [conn2] COMMIT_SKIP_CHECKPOINT
---- ok 
-RELOADDB
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn2] Match (:person) RETURN COUNT(*);
---- 1
10002

-STATEMENT [conn2] MATCH (a:person) DELETE a;
---- ok
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
10002
-STATEMENT [conn2] Match (:person) RETURN COUNT(*);
---- 1
0
-STATEMENT [conn2] COMMIT_SKIP_CHECKPOINT
---- ok 
-RELOADDB
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn1] Match (:person) RETURN COUNT(*);
---- 1
0
-STATEMENT [conn2] CREATE (a:person {ID:10000099});
---- ok
-STATEMENT [conn1] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
0
-STATEMENT [conn2] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn2] COMMIT_SKIP_CHECKPOINT
---- ok 
-RELOADDB
-STATEMENT [conn2] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn1] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
1


#MixedInsertDeleteRollbackNormalExecution
-CASE MixedInsertDeleteRollbackNormalExecution
-LOG Mixed Insert Delete Rollback Normal Execution
-CREATE_CONNECTION conn_read
-CREATE_CONNECTION conn_write
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] MATCH (a:person) WHERE a.ID=8000 DELETE a;
---- ok
-STATEMENT [conn_write] MATCH (a:person) WHERE a.ID=9000 DELETE a;
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:8000});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:9000});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10001});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10002});
---- ok
-STATEMENT [conn_read] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
10002

#Rollback false:is_commit NORMAL_EXECUTION
-STATEMENT [conn_write] Rollback
---- ok 
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
10000

-STATEMENT [conn_write] MATCH (a:person) DELETE a;
---- ok
-STATEMENT [conn_read] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
0
-STATEMENT [conn_write] Rollback
---- ok 


-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn_write] CREATE (a:person {ID:10000099});
---- ok
-STATEMENT [conn_read] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
0
-STATEMENT [conn_write] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_write] Rollback
---- ok 

-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_read] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
0

#MixedInsertDeleteRollbackRecovery
-CASE MixedInsertDeleteRollbackRecovery
-LOG Mixed Insert Delete Rollback Recovery
-CREATE_CONNECTION conn_read
-CREATE_CONNECTION conn_write
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] MATCH (a:person) WHERE a.ID=8000 DELETE a;
---- ok
-STATEMENT [conn_write] MATCH (a:person) WHERE a.ID=9000 DELETE a;
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:8000});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:9000});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10001});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10002});
---- ok
-STATEMENT [conn_read] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
10002

#Rollback false:is_commit RECOVERY 
#init_db and conn?
-STATEMENT [conn_write] ROLLBACK_SKIP_CHECKPOINT
---- ok 
-RELOADDB
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
10000

-STATEMENT [conn_write] MATCH (a:person) DELETE a;
---- ok
-STATEMENT [conn_read] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
0
-STATEMENT [conn_write] ROLLBACK_SKIP_CHECKPOINT
---- ok 
-RELOADDB

-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] Match (:person) RETURN COUNT(*);
---- 1
10000
-STATEMENT [conn_write] CREATE (a:person {ID:10000099});
---- ok
-STATEMENT [conn_read] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
0
-STATEMENT [conn_write] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_write] ROLLBACK_SKIP_CHECKPOINT
---- ok 
-RELOADDB
-STATEMENT [conn_read] Match (a:person) where a.ID=10000099 RETURN COUNT(*);
---- 1
0


#IndexScanAfterInsertionCommitNormalExecution
-CASE IndexScanAfterInsertionCommitNormalExecution
-LOG Index Scan After Insertion Commit Normal Execution
-CREATE_CONNECTION conn_read
-CREATE_CONNECTION conn_write
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10003});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10005});
---- ok
-STATEMENT [conn_write] Match (a:person) WHERE a.ID=10003 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_write] Match (a:person) WHERE a.ID=10005 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_read] Match (a:person) WHERE a.ID=10003 RETURN COUNT(*);
---- 1
0
-STATEMENT [conn_read] Match (a:person) WHERE a.ID=10005 RETURN COUNT(*);
---- 1
0

#commit 
-STATEMENT [conn_write] COMMIT
---- ok 
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok

-STATEMENT [conn_read] Match (a:person) WHERE a.ID=10003 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_read] Match (a:person) WHERE a.ID=10005 RETURN COUNT(*);
---- 1
1

#IndexScanAfterInsertionCommitRecovery
-CASE IndexScanAfterInsertionCommitRecovery
-LOG Index Scan After Insertion Commit Recovery
-CREATE_CONNECTION conn_read
-CREATE_CONNECTION conn_write
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10003});
---- ok
-STATEMENT [conn_write] CREATE (a:person {ID:10005});
---- ok
-STATEMENT [conn_write] Match (a:person) WHERE a.ID=10003 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_write] Match (a:person) WHERE a.ID=10005 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_read] Match (a:person) WHERE a.ID=10003 RETURN COUNT(*);
---- 1
0
-STATEMENT [conn_read] Match (a:person) WHERE a.ID=10005 RETURN COUNT(*);
---- 1
0

#true recovery
-STATEMENT [conn_write] COMMIT_SKIP_CHECKPOINT
---- ok 
-RELOADDB
-STATEMENT [conn_write] BEGIN WRITE TRANSACTION
---- ok

-STATEMENT [conn_write] Match (a:person) WHERE a.ID=10003 RETURN COUNT(*);
---- 1
1
-STATEMENT [conn_write] Match (a:person) WHERE a.ID=10005 RETURN COUNT(*);
---- 1
1

